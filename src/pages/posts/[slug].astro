---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('posts', ({ data }) => !data.draft);
  return posts.map(post => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

function formatDate(date: Date) {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<BaseLayout title={post.data.title} description={post.data.description}>
  <article>
    <h1 class="page-title">{post.data.title}</h1>

    <div class="post-meta">
      <span>{formatDate(post.data.date)}</span>
      {post.data.tags.length > 0 && (
        <div class="post-tags">
          {post.data.tags.map(tag => (
            <a href={`/?tag=${tag}`} class="post-tag">{tag}</a>
          ))}
        </div>
      )}
    </div>

    <div class="prose">
      <Content />
    </div>
  </article>

  <nav style="margin-top: 3rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
    <a href="/" style="font-size: 0.9rem; color: var(--text-muted); text-decoration: none;">← 記事一覧に戻る</a>
  </nav>
</BaseLayout>

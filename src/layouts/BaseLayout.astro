---
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
}

const { title, description = 'Yuta Nakabayashi — design, product, writing' } = Astro.props;
const siteTitle = 'Yuta Nakabayashi';
const pageTitle = title ? `${title} — ${siteTitle}` : siteTitle;

---

<!doctype html>
<html lang="ja" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content={description} />
  <title>{pageTitle}</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <script is:inline>
    // テーマを早期に適用してフラッシュを防ぐ
    const saved = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = saved || (prefersDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', theme);
  </script>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-inner">
        <a href="/" class="site-name">Yuta Nakabayashi</a>
        <nav>
          <a href="/about">About</a>
          <a href="/now">Now</a>
          <button class="theme-toggle" id="theme-toggle" aria-label="テーマを切り替え">D</button>
        </nav>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer>
      <p>© {new Date().getFullYear()} Yuta Nakabayashi</p>
    </footer>
  </div>

  <script>
    const toggle = document.getElementById('theme-toggle');
    const html = document.documentElement;

    function getTheme() {
      return html.getAttribute('data-theme') as string;
    }

    function setTheme(t: string) {
      html.setAttribute('data-theme', t);
      localStorage.setItem('theme', t);
      if (toggle) toggle.textContent = t === 'dark' ? 'L' : 'D';
    }

    function initToggle() {
      if (toggle) toggle.textContent = getTheme() === 'dark' ? 'L' : 'D';
    }

    toggle?.addEventListener('click', () => {
      setTheme(getTheme() === 'dark' ? 'light' : 'dark');
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'd' || e.key === 'D') {
        const tag = (e.target as HTMLElement).tagName;
        if (tag !== 'INPUT' && tag !== 'TEXTAREA') {
          setTheme(getTheme() === 'dark' ? 'light' : 'dark');
        }
      }
    });

    initToggle();
  </script>
</body>
</html>
